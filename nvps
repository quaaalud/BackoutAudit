###imports .csv for BO report audit
###filters out future effective date reversals
###returns "True" if reversal has BO tag and "False" if not
###sorts by True or False and exports to excel


import pandas as pd
import re

bos = pd.read_csv (r"C:\Users\dludwinski\Desktop\Reversed Policies Report (1).csv", 
                   usecols=["ReverseDate", "ReverseReason", "EffectiveDate", 
                            "ReversedBy", "TagList", "ResponseCode"])


bos.insert(0, "BO or NO", "")
bos.insert(6, "BO Tag?", "")
audit = bos.sort_values("ReverseReason")
rev = pd.to_datetime(audit["ReverseDate"])
eff = pd.to_datetime(audit["EffectiveDate"])

audit["BO or NO"] = (rev >= eff)
audit = audit.loc[audit["BO or NO"] == True]

audit = audit.loc[~audit["ReverseReason"].str.contains("Declined", flags=re.I, regex=True)]
audit = audit.reset_index(drop=True)
audit["BO Tag?"] = audit["TagList"].str.contains("- BO") == True
audit = audit.sort_values("BO Tag?")
audit = audit.reset_index(drop=True)

    
print((audit["BO or NO"] == True).count())  
print(audit)



audit.to_excel(r"U:\Dale Cs INFO\NVPS Weekly BO logs\All NVPS BO 9.19 to 9.25.21.xlsx", index=False)
